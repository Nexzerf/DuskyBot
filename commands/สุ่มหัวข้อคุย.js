const { SlashCommandBuilder, EmbedBuilder } = require('discord.js');

const topics = {
  'ทั่วไป': [
    'วันนี้รู้สึกยังไงบ้าง?',
    'กิจวัตรตอนเช้าของคุณเป็นยังไง?',
    'คิดว่าช่วงอายุไหนคือช่วงที่ดีที่สุดในชีวิต?',
    'สิ่งเล็กๆ ที่ทำให้คุณมีความสุขคืออะไร?',
    'เคยมีวันแย่ๆ แล้วผ่านมาได้ยังไง?',
  ],
  'ชีวิตวัยเรียน': [
    'ข้อสอบไหนเคยทำให้ร้องไห้?',
    'เคยโดนเรียกประชุมผู้ปกครองไหม?',
    'เคยทำโปรเจกต์จบตอนตี 4 ไหม?',
    'เคยลอกเพื่อนหรือโดนเพื่อนลอก?',
    'คติประจำใจตอนเรียนคืออะไร?',
  ],
  'เล่นๆ ขำๆ': [
    'ถ้าเป็นสัตว์ได้ 1 วัน จะเลือกเป็นอะไร?',
    'ถ้าแลกสมองกับหมาได้ 1 วันจะยอมไหม?',
    'คิดว่าแมวหรือหมาครองโลก?',
    'ซื้อมาม่ารสไหนตุนช่วงสิ้นเดือน?',
    'ถ้าเปลี่ยนชื่อได้ จะเปลี่ยนเป็นอะไร?',
  ],
  'ความรัก & เพื่อน': [
    'ถ้าแฟนเก่าทักมา จะตอบไหม?',
    'มิตรภาพในกลุ่มมีค่ากว่าความรักไหม?',
    'เคยแอบชอบเพื่อนสนิทไหม?',
    'เพื่อนที่ดีที่สุดของคุณคือใคร?',
    'เชื่อในพรหมลิขิตไหม?',
  ],
  'สาย Dev / Coding': [
    'ภาษาโปรแกรมแรกที่เคยเขียน?',
    'เคย debug จนเกือบร้องไห้ไหม?',
    'Editor ที่ชอบใช้คืออะไร?',
    'เขียนโค้ดตอนกลางวันหรือตอนดึก?',
    'โปรเจกต์ที่ภูมิใจที่สุดคืออะไร?',
  ],
  'สายหมอ / วิทยาศาสตร์': [
    'เคยจำชื่อยาผิดไหม?',
    'เคยสับสนระหว่าง Anatomy กับ Physiology ไหม?',
    'วิชาวิทย์ไหนที่ชอบที่สุด?',
    'โรคที่น่าสนใจที่สุดที่เคยเจอ?',
    'อะไรคือสิ่งที่ทำให้คุณอยากเป็นหมอ?',
  ],
  'ชีวิต & ปรัชญา': [
    'ความสุขสำหรับคุณคืออะไร?',
    'ความล้มเหลวสอนอะไรบ้าง?',
    'ถ้าย้อนเวลากลับไปได้ 1 อย่าง จะทำอะไร?',
    'คิดว่าความฝันสำคัญแค่ไหน?',
    'กลัวการตายไหม?',
  ],
  'เหงา & ใจลึก': [
    'เวลารู้สึกโดดเดี่ยว คุณทำอะไร?',
    'เคยร้องไห้คนเดียวไหม?',
    'คิดถึงใครมากที่สุดตอนนี้?',
    'มีใครที่อยากคุยแต่ไม่กล้าทักไหม?',
    'เคยเขียนจดหมายถึงตัวเองในอนาคตไหม?',
  ]
};

const allTopics = Object.values(topics).flat();

module.exports = {
  data: new SlashCommandBuilder()
    .setName('สุ่มหัวข้อคุย')
    .setDescription('สุ่มหัวข้อสนทนาเพื่อเริ่มบทสนทนาในกลุ่ม')
    .addStringOption(option =>
      option.setName('หมวดหมู่')
        .setDescription('เลือกหมวดหมู่ (ถ้าไม่เลือก จะสุ่มจากทั้งหมด)')
        .setRequired(false)
        .addChoices(
          { name: 'ทั้งหมด', value: 'all' },
          ...Object.keys(topics).map(name => ({ name, value: name }))
        )
    ),

  async execute(interaction) {
    const category = interaction.options.getString('หมวดหมู่') || 'all';
    const selectedList = category === 'all' ? allTopics : topics[category];
    const random = selectedList[Math.floor(Math.random() * selectedList.length)];

    const embed = new EmbedBuilder()
      .setTitle('🗣️ **หัวข้อสนทนา**')
      .setColor('#3333ff')
      .setDescription(`**${random}**`)
      .setFooter({ text: category === 'all' ? 'หมวด: สุ่มทั้งหมด' : `หมวด: ${category}` });

    await interaction.reply({ embeds: [embed] });
  }
};
